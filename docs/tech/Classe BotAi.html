<!DOCTYPE html>
<html>
<head>
<title>Classe BotAi.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<link rel="stylesheet" type="text/css" href="../style/style.css">
<link rel="stylesheet" type="text/css" href="../style/dark-theme.css">
<link rel="stylesheet" type="text/css" href="../style/dark-code.css">
<!-- Side navigation -->
<div class="sidebar">
  <center><img src="../img/Python-logo-notext.svg"></center>
  <h1>Sommaire</h1>
<p><a href="../Battlebotslib%20-%20Python.html">Battlebotslib - Python</a></p>
  <ul>
    <li><a href="../client/Installation%20de%20la%20lib%20Python.html">Installation de la lib Python</a></li>
	<li><a href="Classe%20BotAi.html">Classe BotAi</a></li>
  </ul>
</div>
<!-- Page content -->
<div class="main">
<h1 id="botai">BotAi</h1>
<ul>
<li><a href="#botai">BotAi</a>
<ul>
<li><a href="#propri%C3%A9t%C3%A9s-de-la-classe">Propriétés de la classe</a></li>
<li><a href="#m%C3%A9thodes-de-la-classe">Méthodes de la classe</a></li>
<li><a href="#exceptions">Exceptions</a></li>
<li><a href="#exemple-dutilisation">Exemple d'utilisation</a></li>
</ul>
</li>
</ul>
<p>La classe <code>BotAi</code> fournit une interface haut niveau pour interagir avec le serveur de combat de bots. Il permet à un client de s'inscrire avec un bot, de lire les messages entrants du serveur et de réaliser des actions telles que se déplacer, tourner et tirer.</p>
<h2 id="propri%C3%A9t%C3%A9s-de-la-classe">Propriétés de la classe</h2>
<ul>
<li><code>bot_id</code> : une propriété en lecture seule qui retourne l'identificateur du bot attribué par le serveur.</li>
</ul>
<h2 id="m%C3%A9thodes-de-la-classe">Méthodes de la classe</h2>
<ul>
<li>
<p><code>__init__(self, bot_name: str, team_id: str)</code> : Initialise l'instance de <code>BotAi</code> avec le <code>bot_name</code> et le <code>team_id</code> donnés.</p>
</li>
<li>
<p><code>__enter__(self)</code> : Permet l'utilisation de la déclaration <code>with</code> pour s'assurer que la méthode <code>close</code> est appelée.</p>
</li>
<li>
<p><code>__exit__(self, exc_type, exc_val, exc_tb)</code> : Appelé lorsqu'une déclaration <code>with</code> est quittée.</p>
</li>
<li>
<p><code>close(self)</code> : Ferme tous les threads ouverts.</p>
</li>
<li>
<p><code>enroll(self, bot_id: str = str()) -&gt; str</code> : Inscrit ou réinscrit un bot sur le serveur. Donner un identificateur de bot existant vous permet de connecter ce bot sans en ajouter un nouveau au jeu. Retourne l'identificateur du bot attribué par le serveur.</p>
</li>
<li>
<p><code>read_scanner(self) -&gt; dict</code> : Lit et retire un élément de la file d'attente du scanner. Retourne un dictionnaire contenant les données.<br>
<strong>Exemples</strong></p>
<ul>
<li>Un arbre et un bot sont détectés:<pre class="hljs"><code><div>{
    <span class="hljs-attr">"msg_type"</span>: <span class="hljs-string">"object_detection"</span>,
    <span class="hljs-attr">"source"</span>: <span class="hljs-string">"scanner"</span>,
    <span class="hljs-attr">"data"</span>: [
        {
            <span class="hljs-attr">"from"</span>: <span class="hljs-number">26.5</span>,
            <span class="hljs-attr">"to"</span>: <span class="hljs-number">31</span>,
            <span class="hljs-attr">"object_type"</span>: <span class="hljs-string">"tree"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Tree"</span>,
            <span class="hljs-attr">"distance"</span>: <span class="hljs-number">6.844473640068633</span>
        },
        {
            <span class="hljs-attr">"from"</span>: <span class="hljs-number">34</span>,
            <span class="hljs-attr">"to"</span>: <span class="hljs-number">39.5</span>,
            <span class="hljs-attr">"object_type"</span>: <span class="hljs-string">"bot"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyBot01"</span>,
            <span class="hljs-attr">"distance"</span>: <span class="hljs-number">5.777348380771669</span>
        }
    ]
}
</div></code></pre>
</li>
</ul>
</li>
<li>
<p><code>read_game_message(self) -&gt; dict</code> : Lit et retire un élément de la file d'attente de messages de jeu. Retourne un dictionnaire contenant les données.<br>
<strong>Exemples</strong></p>
<ul>
<li>
<p>État de la partie :</p>
<pre class="hljs"><code><div>{
    <span class="hljs-attr">"msg_type"</span>: <span class="hljs-string">"game_status"</span>,
    <span class="hljs-attr">"source"</span>: <span class="hljs-string">"server"</span>,
    <span class="hljs-attr">"data"</span>: {
        <span class="hljs-attr">"value"</span>: <span class="hljs-literal">false</span>
    }
}
</div></code></pre>
</li>
<li>
<p>Points de vies restants au bot :</p>
<pre class="hljs"><code><div>{
    <span class="hljs-attr">"msg_type"</span>: <span class="hljs-string">"health_status"</span>,
    <span class="hljs-attr">"source"</span>: <span class="hljs-string">"bot"</span>,
    <span class="hljs-attr">"data"</span>: {
        <span class="hljs-attr">"value"</span>: <span class="hljs-number">95</span>
    }
}
</div></code></pre>
</li>
<li>
<p>Vitesse de déplacement max actuelle du bot en unité par seconde :</p>
<pre class="hljs"><code><div>{
    <span class="hljs-attr">"msg_type"</span>: <span class="hljs-string">"moving_speed_status"</span>,
    <span class="hljs-attr">"source"</span>: <span class="hljs-string">"bot"</span>,
    <span class="hljs-attr">"data"</span>: {
        <span class="hljs-attr">"value"</span>: <span class="hljs-number">1.0</span>
    }
}
</div></code></pre>
</li>
<li>
<p>Vitesse de rotation max actuelle du bot en radians par seconde :</p>
<pre class="hljs"><code><div>{
    <span class="hljs-attr">"msg_type"</span>: <span class="hljs-string">"turning_speed_status"</span>,
    <span class="hljs-attr">"source"</span>: <span class="hljs-string">"bot"</span>,
    <span class="hljs-attr">"data"</span>: {
        <span class="hljs-attr">"value"</span>: <span class="hljs-number">0.52359877559829887307710723054658</span>
    }
}
</div></code></pre>
</li>
<li>
<p>Si le bot a été assommé (déplacements impossibles) :</p>
<pre class="hljs"><code><div>{
    <span class="hljs-attr">"msg_type"</span>: <span class="hljs-string">"stunning_status"</span>,
    <span class="hljs-attr">"source"</span>: <span class="hljs-string">"bot"</span>,
    <span class="hljs-attr">"data"</span>: {
        <span class="hljs-attr">"value"</span>: <span class="hljs-literal">true</span>
    }
}
</div></code></pre>
</li>
<li>
<p>Si le bot a commencé ou arrêté de se déplacer :</p>
<pre class="hljs"><code><div>{
    <span class="hljs-attr">"msg_type"</span>: <span class="hljs-string">"moving_status"</span>,
    <span class="hljs-attr">"source"</span>: <span class="hljs-string">"bot"</span>,
    <span class="hljs-attr">"data"</span>: {
        <span class="hljs-attr">"value"</span>: <span class="hljs-literal">false</span>
    }
}
</div></code></pre>
</li>
<li>
<p>Si le bot a commencé ou arrêté de tourner :</p>
<pre class="hljs"><code><div>{
    <span class="hljs-attr">"msg_type"</span>: <span class="hljs-string">"turning_status"</span>,
    <span class="hljs-attr">"source"</span>: <span class="hljs-string">"bot"</span>,
    <span class="hljs-attr">"data"</span>: {
        <span class="hljs-attr">"value"</span>: <span class="hljs-literal">false</span>
    }
}
</div></code></pre>
</li>
<li>
<p>Si l'arme du bot peut tirer ou non (rechargement) :</p>
<pre class="hljs"><code><div>{
    <span class="hljs-attr">"msg_type"</span>: <span class="hljs-string">"weapon_can_shoot"</span>,
    <span class="hljs-attr">"source"</span>: <span class="hljs-string">"bot"</span>,
    <span class="hljs-attr">"data"</span>: {
        <span class="hljs-attr">"value"</span>: <span class="hljs-literal">false</span>
    }
}
</div></code></pre>
</li>
<li>
<p>Temps de rechargement de l'arme du bot entre chaque tirs :</p>
<pre class="hljs"><code><div>{
    <span class="hljs-attr">"msg_type"</span>: <span class="hljs-string">"weapon_cooldown_ms"</span>,
    <span class="hljs-attr">"source"</span>: <span class="hljs-string">"bot"</span>,
    <span class="hljs-attr">"data"</span>: {
        <span class="hljs-attr">"value"</span>: <span class="hljs-number">1000</span>
    }
}
</div></code></pre>
</li>
</ul>
</li>
<li>
<p><code>move(self, state: bool)</code> : Commence ou arrête de faire avancer le bot. <code>state</code> peut être soit <code>True</code> ou <code>False</code>.</p>
</li>
<li>
<p><code>turn(self, direction: str)</code> : Commence ou arrête de tourner le bot dans une direction. <code>direction</code> peut être <code>&quot;left&quot;</code>, <code>&quot;right&quot;</code> ou <code>&quot;stop&quot;</code>.</p>
</li>
<li>
<p><code>shoot(self, angle: float)</code> : Tire à l'angle souhaité, spécifié en degrés.</p>
</li>
</ul>
<h2 id="exceptions">Exceptions</h2>
<ul>
<li><code>RestException</code> : Levée en cas d'erreur lors d'un appel d'API REST.</li>
</ul>
<h2 id="exemple-dutilisation">Exemple d'utilisation</h2>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> sleep
<span class="hljs-keyword">from</span> threading <span class="hljs-keyword">import</span> Event, Thread
<span class="hljs-keyword">from</span> queue <span class="hljs-keyword">import</span> SimpleQueue
<span class="hljs-keyword">from</span> battlebotslib.BotAi <span class="hljs-keyword">import</span> BotAi


<span class="hljs-comment"># Game information</span>
G_GAME_IS_STARTED = <span class="hljs-literal">False</span>

<span class="hljs-comment"># Bot information</span>
G_BOT_HEALTH: int = <span class="hljs-number">999</span>     <span class="hljs-comment"># Depends on the bot type, we need to read this information from the game messages</span>
G_BOT_IS_MOVING: bool = <span class="hljs-literal">False</span>
G_BOT_IS_TURNING: bool = <span class="hljs-literal">False</span>
G_BOT_TURN_DIRECTION: str = str()
G_BOT_IS_STUNNED: bool = <span class="hljs-literal">False</span>
G_WEAPON_CAN_SHOOT: bool = <span class="hljs-literal">True</span>

<span class="hljs-comment"># Will be used to store all the objects to shoot at</span>
G_BOT_TARGETS_QUEUE: SimpleQueue = SimpleQueue()


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">thread_read_scanner_queue</span><span class="hljs-params">(e: Event, bot_ai: BotAi)</span>:</span>
    <span class="hljs-string">"""
    Thread continuously reading messages from the bot scanner queue.
    """</span>
    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> e.is_set():
        scanner_message = bot_ai.read_scanner()
        logging.debug(<span class="hljs-string">f"[SCANNER] <span class="hljs-subst">{scanner_message}</span>"</span>)
        handle_scanner_message(scanner_message)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">thread_read_game_queue</span><span class="hljs-params">(e: Event, bot_ai: BotAi)</span>:</span>
    <span class="hljs-string">"""
    Thread continuously reading messages from the game queue.
    """</span>
    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> e.is_set():
        game_message = bot_ai.read_game_message()
        logging.debug(<span class="hljs-string">f"[GAME] <span class="hljs-subst">{game_message}</span>"</span>)
        handle_game_message(game_message)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle_scanner_message</span><span class="hljs-params">(message: dict)</span>:</span>
    <span class="hljs-string">"""
    Handle a new scanner message.
    """</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">if</span> message[<span class="hljs-string">'msg_type'</span>] == <span class="hljs-string">"object_detection"</span>:
            <span class="hljs-comment"># Browsing detected objects</span>
            <span class="hljs-keyword">for</span> detected_object <span class="hljs-keyword">in</span> message[<span class="hljs-string">'data'</span>]:
                is_valid_target = <span class="hljs-literal">False</span>
                target = <span class="hljs-literal">None</span>
                match detected_object[<span class="hljs-string">'object_type'</span>]:
                    <span class="hljs-comment"># We want to shoot at trees and bots</span>
                    case <span class="hljs-string">"tree"</span>:
                        is_valid_target = <span class="hljs-literal">True</span>
                        target = detected_object
                    case <span class="hljs-string">"bot"</span>:
                        is_valid_target = <span class="hljs-literal">True</span>
                        target = detected_object
                    <span class="hljs-comment"># We cannot walk on water</span>
                    case <span class="hljs-string">"tile"</span>:
                        <span class="hljs-keyword">if</span> detected_object[<span class="hljs-string">"name"</span>].lower() == <span class="hljs-string">"water"</span>:
                            logging.debug(<span class="hljs-string">"WATER WATER WATER!!!"</span>)
                    case _:
                        <span class="hljs-keyword">pass</span>

                <span class="hljs-keyword">if</span> is_valid_target:
                    target_angle = (target[<span class="hljs-string">'from'</span>] + target[<span class="hljs-string">'to'</span>]) / <span class="hljs-number">2</span>
                    logging.info(<span class="hljs-string">f"[SCANNER] <span class="hljs-subst">{target[<span class="hljs-string">'name'</span>]}</span> detected at a distance of "</span>
                                 <span class="hljs-string">f"<span class="hljs-subst">{target[<span class="hljs-string">'distance'</span>]}</span> (<span class="hljs-subst">{target_angle}</span>°)"</span>)
                    G_BOT_TARGETS_QUEUE.put(target_angle)
        <span class="hljs-keyword">else</span>:
            logging.error(<span class="hljs-string">f"Unknown scanner message: <span class="hljs-subst">{message}</span>"</span>)
    <span class="hljs-keyword">except</span>:
        logging.error(<span class="hljs-string">f"Bad scanner message format: <span class="hljs-subst">{message}</span>"</span>)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle_game_message</span><span class="hljs-params">(message: dict)</span>:</span>
    <span class="hljs-string">"""
    Handle a new game message.
    """</span>
    <span class="hljs-keyword">try</span>:
        match message[<span class="hljs-string">'msg_type'</span>]:
            case <span class="hljs-string">"health_status"</span>:
                <span class="hljs-keyword">global</span> G_BOT_HEALTH
                <span class="hljs-comment"># Bot health update</span>
                G_BOT_HEALTH = message[<span class="hljs-string">'data'</span>][<span class="hljs-string">'value'</span>]
                show_bot_stats()
            case <span class="hljs-string">"game_status"</span>:
                <span class="hljs-keyword">global</span> G_GAME_IS_STARTED
                <span class="hljs-comment"># Game is running or stopped</span>
                G_GAME_IS_STARTED = message[<span class="hljs-string">'data'</span>]
            case <span class="hljs-string">"stunning_status"</span>:
                <span class="hljs-keyword">global</span> G_BOT_IS_STUNNED
                <span class="hljs-comment"># Bot is stunned or not</span>
                G_BOT_IS_STUNNED = message[<span class="hljs-string">'data'</span>][<span class="hljs-string">'value'</span>]
            case <span class="hljs-string">"moving_status"</span>:
                <span class="hljs-keyword">global</span> G_BOT_IS_MOVING
                <span class="hljs-comment"># Bot is moving or not</span>
                G_BOT_IS_MOVING = message[<span class="hljs-string">'data'</span>][<span class="hljs-string">'value'</span>]
            case <span class="hljs-string">"turning_status"</span>:
                <span class="hljs-keyword">global</span> G_BOT_IS_TURNING
                <span class="hljs-keyword">global</span> G_BOT_TURN_DIRECTION
                <span class="hljs-keyword">if</span> message[<span class="hljs-string">'data'</span>][<span class="hljs-string">'value'</span>] == <span class="hljs-string">'stop'</span>:
                    <span class="hljs-comment"># Bot has been stopped</span>
                    G_BOT_IS_TURNING = <span class="hljs-literal">False</span>
                <span class="hljs-keyword">else</span>:
                    <span class="hljs-comment"># Turn direction</span>
                    G_BOT_IS_TURNING = <span class="hljs-literal">True</span>
                    G_BOT_TURN_DIRECTION = message[<span class="hljs-string">'data'</span>][<span class="hljs-string">'value'</span>]
            case <span class="hljs-string">"weapon_can_shoot"</span>:
                <span class="hljs-keyword">global</span> G_WEAPON_CAN_SHOOT
                G_WEAPON_CAN_SHOOT = message[<span class="hljs-string">'data'</span>][<span class="hljs-string">'value'</span>]
            case _:
                logging.error(<span class="hljs-string">f"Unknown game message: <span class="hljs-subst">{message}</span>"</span>)
    <span class="hljs-keyword">except</span>:
        logging.error(<span class="hljs-string">f"Bad game message format: <span class="hljs-subst">{message}</span>"</span>)


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show_bot_stats</span><span class="hljs-params">()</span>:</span>
    logging.info(<span class="hljs-string">f"Health: <span class="hljs-subst">{G_BOT_HEALTH}</span>"</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># Logging</span>
    logging.basicConfig(
        level=logging.DEBUG, datefmt=<span class="hljs-string">'%d/%m/%Y %I:%M:%S'</span>, format=<span class="hljs-string">'[%(levelname)s] %(asctime)s - %(message)s'</span>
    )

    <span class="hljs-comment"># Creating a new Bot</span>
    <span class="hljs-keyword">with</span> BotAi(bot_name=<span class="hljs-string">"MyBot"</span>, team_id=<span class="hljs-string">"team-id-1"</span>) <span class="hljs-keyword">as</span> bot:
        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">stop</span><span class="hljs-params">()</span>:</span>
            <span class="hljs-comment"># Closing messages reading threads</span>
            scanner_message_thread_event.set()
            game_message_thread_event.set()

        <span class="hljs-comment"># Enrolling the new bot on the server</span>
        bot_id = bot.enroll()

        <span class="hljs-comment"># Bot scanner messages handler thread</span>
        scanner_message_thread_event = Event()
        Thread(target=thread_read_scanner_queue, args=(scanner_message_thread_event, bot)).start()

        <span class="hljs-comment"># Game messages handler thread</span>
        game_message_thread_event = Event()
        Thread(target=thread_read_game_queue, args=(game_message_thread_event, bot)).start()

        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># Waiting for the game to start</span>
            <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> G_GAME_IS_STARTED:
                sleep(<span class="hljs-number">0.1</span>)

            <span class="hljs-comment"># While the bot is alive and the game is running</span>
            <span class="hljs-keyword">while</span> G_BOT_HEALTH &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> G_GAME_IS_STARTED:
                <span class="hljs-comment"># ############################################################</span>
                <span class="hljs-comment">#</span>
                <span class="hljs-comment"># AI logic goes here. Example:</span>
                <span class="hljs-comment">#</span>
                <span class="hljs-comment"># try:</span>
                <span class="hljs-comment">#     if not G_BOT_TARGETS_QUEUE.empty():</span>
                <span class="hljs-comment">#         bot.shoot(G_BOT_TARGETS_QUEUE.get(block=False))</span>
                <span class="hljs-comment">#     if not G_BOT_IS_MOVING:</span>
                <span class="hljs-comment">#         bot.move(True)</span>
                <span class="hljs-comment">#     if not G_BOT_IS_TURNING:</span>
                <span class="hljs-comment">#         bot.turn(random.choice(['left', 'right']))</span>
                <span class="hljs-comment"># except BotAi.RestException as ex:</span>
                <span class="hljs-comment">#     pass</span>
                <span class="hljs-comment"># </span>
                <span class="hljs-comment"># ############################################################</span>
            
            <span class="hljs-comment"># Game has stopped or the bot is dead</span>
            <span class="hljs-keyword">if</span> G_BOT_HEALTH &lt;= <span class="hljs-number">0</span>:
                logging.info(<span class="hljs-string">"Bot is dead"</span>)
            <span class="hljs-keyword">elif</span> <span class="hljs-keyword">not</span> G_GAME_IS_STARTED:
                logging.info(<span class="hljs-string">"Game has been stopped"</span>)

            stop()

        <span class="hljs-keyword">except</span> KeyboardInterrupt:
            logging.info(<span class="hljs-string">"Bot has been aborted"</span>)
            stop()

</div></code></pre>
<hr>
<p><a href="#top">⬆️ Retour</a> - <em>Classe BotAi</em></p>
</div>

</body>
</html>
